{% extends '@EasyAdmin/page/content.html.twig' %}

{% block content_title %}Création d'une vente{% endblock %}

{% block main %}
 <div class="alert alert-success mb-4">
  Vous avez sélectionné le client : <b>{{ contact.company.name }} : {{ contact.firstname }} {{ contact.lastname }}</b>
 </div>

 <div class="alert alert-success mb-4">
  Vous avez sélectionné le produit :  <b>{{ product.project.name }} : {{ product.name }}</b>
 </div>

 {% if stock_avalaible is defined %}
  <div class="alert alert-info mb-4">
   Il reste <b>{{ stock_avalaible }}</b> {{ product.name }} en stock.
  </div>
{% endif %}

 {{ form_start(form) }}
 <div class="row">

  {{ form_row(form.quantity) }}
  {{ form_row(form.price) }}

  <p class="mt-4"><b>Prix total :</b> <span id="result">{{ (form.vars.value.price * form.vars.value.quantity)|number_format(2, ',', ' ') }}</span> €</p>

  <script>
   var x = document.getElementById("Sales_quantity");
   var y = document.getElementById("Sales_price");

   x.addEventListener('change', (event) => {
    var a = document.getElementById("Sales_quantity").value;
    var b = document.getElementById("Sales_price").value;
    var value = parseFloat(a.replace(',', '.')) * parseFloat(b.replace(',', '.'));
    document.getElementById("result").innerHTML = value.toFixed(2);
   });

   y.addEventListener('change', (event) => {
    var a = document.getElementById("Sales_quantity").value;
    var b = document.getElementById("Sales_price").value;
    var value = parseFloat(a.replace(',', '.')) * parseFloat(b.replace(',', '.'));
    document.getElementById("result").innerHTML = value.toFixed(2);
   });


  </script>


  {{ form_row(form.date) }}
  {{ form_widget(form.product, {'attr': {'class': 'd-none'}}) }}
  {{ form_widget(form.contact, {'attr': {'class': 'd-none'}}) }}

  <div class="mt-3">
    <input type="submit" value="Créer la vente" class="btn btn-primary">
  </div>
 </div>
 {{ form_end(form) }}

{% endblock %}